(window.webpackJsonp=window.webpackJsonp||[]).push([[139],{2751:function(t,e,r){"use strict";r.r(e);var n=r(4),o=(r(35),r(146),r(145),r(52),r(669),r(42),r(45),r(8),r(32),r(28),r(44),r(43),r(365),r(2494)),c=r.n(o),l=r(136),d=r.n(l);console.log(c.a);var h={name:"StarHistory",components:{VeLine:c.a},data:function(){return{repo:"",token:"",loading:!1,sampleNum:15,chartData:{columns:["date","starNum"],rows:[]},chartExtend:{legend:{show:!1}},chartSettings:{legend:{show:!1},xAxisType:"time"}}},methods:{query:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.loading=!0,t.chartData.rows=[],t.repo.includes("github.com")?(t.repo+="/",t.repo=/github\.com\/(\S*?\/\S*?)[/#?]/.exec(t.repo)[1]):t.repo=""==t.repo?"Ice-Hazymoon/MikuTools":t.repo,t.$db.read(),!(r=t.$db.data.tool.star_history[t.repo])){e.next=10;break}t.loading=!1,t.chartData.rows=r,e.next=24;break;case 10:return e.prev=10,e.next=13,t.getStarHistory(t.repo,t.token?t.token:void 0);case 13:n=e.sent,t.loading=!1,t.chartData.rows=n,t.$db.data.tool.star_history[t.repo]=n,t.$db.write(),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(10),t.loading=!1,e.t0.message.indexOf("403")>=0?t.$notify.error({title:"统计失败",message:"请求次数过多，请填写 Token 以获取更多配额"}):t.$notify.error({title:"统计失败",message:e.t0});case 24:case"end":return e.stop()}}),e,null,[[10,20]])})))()},range:function(t){return Array.apply(null,{length:t}).map((function(t,i){return i+1}))},generateUrls:function(t,e){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o,c,l,link,h,m,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=d.a.create({headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:e}}),c="https://api.github.com/repos/".concat(t,"/stargazers"),n.next=4,o.get(c,{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:e}});case 4:return l=n.sent,link=l.headers.link,h=link?/next.*?page=(\d*).*?last/.exec(link)[1]:1,m=h<=r.sampleNum?r.range(h).slice(1,h):r.range(r.sampleNum).map((function(t){return Math.round(t/r.sampleNum*h)-1})),f=m.map((function(t){return"".concat(c,"?page=").concat(t)})),n.abrupt("return",{firstPage:l,sampleUrls:f,pageIndexes:m});case 10:case"end":return n.stop()}}),n)})))()},getStarHistory:function(t,e){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o,c,l,h,m,f,k,v,y,w,x,_,S,D,M,A,H;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=d.a.create({headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:e}}),n.next=3,r.generateUrls(t,e);case 3:return c=n.sent,l=c.sampleUrls,h=c.pageIndexes,m=c.firstPage,f=[m].concat(l.map((function(t){return o.get(t,{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:e}})}))),n.next=10,Promise.all(f);case 10:return k=n.sent,v=null,h[h.length-1]>r.sampleNum?v=h.map((function(p,i){return{date:k[i+1].data[0].starred_at.slice(0,10),starNum:30*(p-1)}})):(y=k.reduce((function(t,e){return t.concat(e.data)}),[]),w=new Date(y[0].starred_at),x=Math.round(new Date-w)/864e5,_=Array.from(new Array(50)).map((function(t,i){var e=new Date(w);return e.setDate(e.getDate()+Math.floor(x/50*(i+1))),e.toISOString().slice(0,10)}),[]),v=_.map((function(t){var e=0,r=y.find((function(r,i){return r.starred_at.slice(0,10)>=t&&(e=i+1,!0)}));return r&&{date:r.starred_at.slice(0,10),starNum:e}})).filter((function(t){return t}))),n.next=15,o.get("https://api.github.com/repos/".concat(t),{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:e}});case 15:return S=n.sent,D=S.data.stargazers_count,M=new Date,A=M.getMonth()+1>10?M.getMonth()+1:"0".concat(M.getMonth()+1),H=M.getDate()>10?M.getDate():"0".concat(M.getDate()),v.push({date:"".concat(M.getFullYear(),"-").concat(A,"-").concat(H),starNum:D}),n.abrupt("return",v);case 22:case"end":return n.stop()}}),n)})))()}}},m=r(2),f=function(t){t.exports.head={meta:[{hid:"keywords",keywords:"GitHub Star历史,Star历史查询,MikuTools,Ice-Hazymoon,在线工具"},{hid:"description",description:"GitHub Star历史记录查询"}],title:"Star 历史查询 - MikuTools"},t.options.toolsMeta={name:"Star 历史查询",path:"/star_history",head:{meta:[{hid:"keywords",keywords:"GitHub Star历史,Star历史查询,MikuTools,Ice-Hazymoon,在线工具"},{hid:"description",description:"GitHub Star历史记录查询"}],title:"Star 历史查询 - MikuTools"},show:!0,key:"development"}},component=Object(m.a)(h,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"star_history"},[r("nya-container",{attrs:{title:"Star 历史查询"}},[r("div",{staticClass:"nya-subtitle"},[t._v("\n            请输入GitHub项目地址\n        ")]),r("el-input",{staticClass:"mb-15",attrs:{autofocus:"",disabled:t.loading,placeholder:"https://github.com/Ice-Hazymoon/MikuTools"},model:{value:t.repo,callback:function(e){t.repo="string"==typeof e?e.trim():e},expression:"repo"}}),r("div",{staticClass:"nya-subtitle"},[t._v("\n            Access Token\n        ")]),r("el-input",{staticClass:"mb-15",attrs:{autofocus:"",disabled:t.loading,placeholder:"私有仓库或访问超过限制则必填"},model:{value:t.token,callback:function(e){t.token="string"==typeof e?e.trim():e},expression:"token"}}),r("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.query}},[t._v("\n            "+t._s(t.loading?"统计中":"开始统计")+"\n        ")])],1),t.chartData.rows.length?r("nya-container",{attrs:{title:"查询结果"}},[r("ve-line",{attrs:{data:t.chartData,settings:t.chartSettings,extend:t.chartExtend}})],1):t._e(),r("nya-container",{attrs:{title:"说明"}},[r("ul",{staticClass:"nya-list"},[r("li",[t._v("Access Token 申请地址："),r("a",{attrs:{href:"https://github.com/settings/tokens/new?scopes=repo",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/settings/tokens/new?scopes=repo")])]),r("li",[t._v("所有过程都不会经过 MikuTools 的服务器，本站不会记录你的 Access Token，可放心使用")])])])],1)}),[],!1,null,null,null);"function"==typeof f&&f(component);e.default=component.exports}}]);