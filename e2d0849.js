(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{1211:function(t,e,o){"use strict";o(866)},1212:function(t,e,o){"use strict";o(867)},2639:function(t,e,o){"use strict";o.r(e);var n=o(11),r=o.n(n),l=o(103),c=o.n(l),f=o(24),m=o(4);o(35),o(52),o(55),o(20),o(8),o(28),o(43),o(68),o(69);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}function v(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(f.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var h={openQqGroup:{name:"打开 QQ 群",dataTemplate:{idkey:""}}},y={data:function(){var t=Object.keys(h).map((function(t){return{label:h[t].name,value:t}}));return t.push({label:"默认",value:""}),{loading:!1,formData:{title:"",body:"",icon:"/icon.png",image:"",tag:"",data:null},tagOptions:t,rules:{title:[{required:!0,message:"请输入推送标题",trigger:"blur"}]}}},methods:{onSubmit:function(){var t=this;this.validate((function(){t.loading=!0,t.$axios.post("/webpush",t.formData).then((function(){return t.$message.success("发送成功")})).catch((function(e){t.$notify.error({title:"提交失败",message:e})})).finally((function(){return t.loading=!1}))}))},onTest:function(){var t=this;this.validate((function(){t.showNotification(t.formData.title,t.formData)}))},validate:function(t){this.$refs.webpushForm.validate((function(e){e&&t()}))},showNotification:function(title){var t=arguments,e=this;return Object(m.a)(regeneratorRuntime.mark((function o(){var n,r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(n=t.length>1&&void 0!==t[1]?t[1]:{},"Notification"in window&&"serviceWorker"in navigator){o.next=3;break}return o.abrupt("return",e.$message.error("设备不支持"));case 3:if("granted"===window.Notification.permission){o.next=5;break}return o.abrupt("return",e.$message.error("权限被拒绝"));case 5:return o.prev=5,o.next=8,navigator.serviceWorker.getRegistration();case 8:return r=o.sent,o.abrupt("return",r.showNotification(title,v({vibrate:[100,50,100]},n)));case 12:return o.prev=12,o.t0=o.catch(5),o.abrupt("return",e.$message.error("SW 未注册"));case 15:case"end":return o.stop()}}),o,null,[[5,12]])})))()}}},w=(o(1211),o(2)),x={name:"Addmin",components:{webpush:Object(w.a)(y,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"webpush"},[o("nya-container",{attrs:{title:"发送推送"}},[o("el-form",{ref:"webpushForm",staticClass:"nya-input-btn",attrs:{rules:t.rules,model:t.formData,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"标题",prop:"title"}},[o("el-input",{attrs:{placeholder:"输入推送标题"},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),o("el-form-item",{attrs:{label:"内容",prop:"body"}},[o("el-input",{attrs:{placeholder:"输入推送内容"},model:{value:t.formData.body,callback:function(e){t.$set(t.formData,"body",e)},expression:"formData.body"}})],1),o("el-form-item",{attrs:{label:"图标",prop:"icon"}},[o("el-input",{attrs:{placeholder:"输入推送 icon"},model:{value:t.formData.icon,callback:function(e){t.$set(t.formData,"icon",e)},expression:"formData.icon"}})],1),o("el-form-item",{attrs:{label:"图片",prop:"image"}},[o("el-input",{attrs:{placeholder:"输入推送图片"},model:{value:t.formData.image,callback:function(e){t.$set(t.formData,"image",e)},expression:"formData.image"}})],1),o("el-form-item",{attrs:{label:"震动规则"}},[o("el-input",{attrs:{disabled:"",value:"默认"}})],1),o("el-form-item",{attrs:{label:"推送标记"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:"请选择推送标记"},model:{value:t.formData.tag,callback:function(e){t.$set(t.formData,"tag",e)},expression:"formData.tag"}},t._l(t.tagOptions,(function(option,t){return o("el-option",{key:t,attrs:{label:option.label,value:option.value}})})),1)],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.onSubmit}},[t._v("\n                    "+t._s(t.loading?"提交中":"发送全站推送")+"\n                ")]),o("el-button",{on:{click:t.onTest}},[t._v("\n                    预览推送\n                ")])],1)],1)],1)],1)}),[],!1,null,null,null).exports},head:function(){return{title:this.title}},data:function(){return{title:"管理 - ".concat("MikuTools"),loading:!1,cardRequestIn:!1,notification:"",form:{title:"",content:"",color:"var(--theme)"}}},computed:{result:function(){return c()(this.form.content,{breaks:!0})}},mounted:function(){this.getNotice()},methods:{formatDate:function(t){return r.a.unix(t).format("YYYY年MM月DD日 HH:mm:ss")},getNotice:function(){var t=this;this.$axios.get("/notification").then((function(e){e.data.data.id&&(t.form.content=e.data.data.content,t.form.title=e.data.data.title)})).catch((function(e){t.$notify.error({title:"获取通知失败",message:"可能是服务器正在维护中：".concat(e)})}))},submit:function(){var t=this;this.loading||(this.loading=!0,this.$axios.post("/notification",{content:this.form.content,title:this.form.title,color:this.form.color}).then((function(){t.loading=!1,t.$message.success("发送成功")})).catch((function(e){t.$notify.error({title:"提交失败",message:e}),t.loading=!1})))}}},k=(o(1212),Object(w.a)(x,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"addmin"},[o("nya-container",{attrs:{title:"发送通知"}},[o("el-form",{staticClass:"nya-input-btn",attrs:{model:t.form},nativeOn:{submit:function(t){t.preventDefault()}}},[o("div",{staticClass:"nya-subtitle"},[t._v("\n                请输入通知标题\n            ")]),o("el-form-item",{attrs:{prop:"title"}},[o("el-input",{attrs:{autofocus:"",placeholder:"输入通知标题"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),o("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n                请输入通知内容\n            ")]),o("el-form-item",{attrs:{prop:"content"}},[o("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},autofocus:"",placeholder:"请输入通知内容"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),o("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n                选择日志颜色\n            ")]),o("el-form-item",[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:t.form.color,callback:function(e){t.$set(t.form,"color",e)},expression:"form.color"}},[o("el-option",{attrs:{label:"蓝色",value:"var(--theme)"}},[o("span",{staticClass:"dot",style:{backgroundColor:"var(--theme)"}}),o("span",{staticStyle:{color:"#8492a6","font-size":"13px"}},[t._v("蓝色")])]),o("el-option",{attrs:{label:"红色",value:"var(--color-danger)"}},[o("span",{staticClass:"dot",style:{backgroundColor:"var(--color-danger)"}}),o("span",{staticStyle:{color:"#8492a6","font-size":"13px"}},[t._v("红色")])]),o("el-option",{attrs:{label:"绿色",value:"var(--color-success)"}},[o("span",{staticClass:"dot",style:{backgroundColor:"var(--color-success)"}}),o("span",{staticStyle:{color:"#8492a6","font-size":"13px"}},[t._v("绿色")])]),o("el-option",{attrs:{label:"黄色",value:"var(--color-warning)"}},[o("span",{staticClass:"dot",style:{backgroundColor:"var(--color-warning)"}}),o("span",{staticStyle:{color:"#8492a6","font-size":"13px"}},[t._v("黄色")])]),o("el-option",{attrs:{label:"灰色",value:"var(--color-text-placeholder)"}},[o("span",{staticClass:"dot",style:{backgroundColor:"var(--color-text-placeholder)"}}),o("span",{staticStyle:{color:"#8492a6","font-size":"13px"}},[t._v("灰色")])])],1)],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.submit}},[t._v("\n                    "+t._s(t.loading?"提交中":"发送全站通知")+"\n                ")])],1)],1)],1),o("nya-container",{directives:[{name:"show",rawName:"v-show",value:t.result,expression:"result"}],attrs:{title:"预览通知"}},[o("div",{staticClass:"typo",domProps:{innerHTML:t._s(t.result)}})]),o("webpush")],1)}),[],!1,null,null,null));e.default=k.exports},866:function(t,e,o){t.exports={}},867:function(t,e,o){t.exports={}}}]);